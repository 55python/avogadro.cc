<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Refactoring Ideas - Avogadro</title>




<meta name="description" content="This page contains some ideas about future refactorization of libavogadro. They may seriously break ABI (and possibly API), and should be discussed">




<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Avogadro">
<meta property="og:title" content="Refactoring Ideas">


  <link rel="canonical" href="https://avogadro.org/developer/refactoring_ideas/">
  <meta property="og:url" content="https://avogadro.org/developer/refactoring_ideas/">



  <meta property="og:description" content="This page contains some ideas about future refactorization of libavogadro. They may seriously break ABI (and possibly API), and should be discussed">



  <meta name="twitter:site" content="@AvogadroChem">
  <meta name="twitter:title" content="Refactoring Ideas">
  <meta name="twitter:description" content="This page contains some ideas about future refactorization of libavogadro. They may seriously break ABI (and possibly API), and should be discussed">
  <meta name="twitter:url" content="https://avogadro.org/developer/refactoring_ideas/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-02-04T11:24:08-05:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Avogadro Chemistry",
      "url" : "https://avogadro.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://avogadro.org/feed.xml" type="application/atom+xml" rel="alternate" title="Avogadro Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://avogadro.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->





<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--default">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://avogadro.org/">Avogadro</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://sourceforge.net/projects/avogadro/files/latest/download">Download</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://avogadro.org/docs/">Manual</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://discuss.avogadro.cc">Discuss</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://avogadro.org/credits/">Thanks</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <p>This page contains some ideas about future refactorization of libavogadro. They may seriously break ABI (and possibly API), and should be discussed</p>

<h2 id="rendering-widget">Rendering Widget</h2>

<ul>
  <li>Make libavogadro use abstract RenderWidget instead of GLWidget</li>
  <li>Inherit GLWidget from RenderWidget and QGLWidget, move GL-independent functionality (e.g., plugin access) up to RenderWidget</li>
</ul>

<p><strong>Fix</strong>: multiple inheritance for QWidgets is tricky. Another variant of design:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Renderer - ADT, doesn't inherit anything from Qt.
      Contains generic functionality like access methods, PainterDevice access, no signals/slots.
GLWidget : public Renderer, public QGLWidget
GL2Widget etc. ananlogically
SimpleRenderWidget : public Renderer, public QGraphicsView
AvogadroWidget - inherits QWidget, is directly used in UI of external client. 
      Contains pointer RenderWidget* to one chosen renderer, can switch them, can load RenderWidget* from plugin
</code></pre>
</div>

<ul>
  <li>Remove most of OpenGL calls from engines, replace them by new methods of PainterDevice</li>
</ul>

<p><strong>Note</strong>: Of course, GL only engines can exist for some specific purposes (maybe Cartoon, Ring), but such GL tasks as setting fg color, drawing eyecandy, GL_RESCALE_NORMAL, GL_NORMALIZE should be encapsulated into renderer.</p>

<ul>
  <li>Remove all GL calls from Avogadro application - GUI client must work without any knowledge of backend. Call GL2PS from libavogadro if needed. Move glgraphicsview to libAvogadroWidget, don’t use it in Avogadro application directly but through generic backend-independent view.</li>
  <li>Add minimalistic SimpleRenderWidget without OpenGL (to create images for publication, b/w images, for use on old/heavy loaded PCs, etc). Also, some rendering imitation could be added - would be sufficient for reliable production of PDF and SVG without polygons.</li>
  <li>Create separate GLWidgets for OpenGL2, 3, 4, etc (?)</li>
  <li>“On-line” POV-Ray rendering for aesthetes (???)</li>
</ul>

<h2 id="plotwidget">PlotWidget</h2>

<ul>
  <li>Make it stronger and used by 3rd party developers - I think there are some projects interested in easy Qt way to do it without linking to KDE</li>
  <li>Rename it to QPlotWidget and publish as independent library - may be some contributors will appear</li>
  <li>Qt Designer plugin for QPlotWidget (?)</li>
  <li>KPlotWidget is LGPL, so we can change its license to LGPL</li>
  <li>Try to merge KPlotWidget with QPlotWIdget
    <ul>
      <li>KPlotWidget didn’t evolve a lot from time it was forked for Avogadro</li>
      <li>so it could be simple KDE wrapper for QPlotWidget library and some KDE-specific features</li>
      <li>[crazy idea] We can try to push QPlotWidget in QtGui, and KDE folks will do all work theirselves :)</li>
    </ul>
  </li>
</ul>

<h2 id="modularization-of-libavogadro">Modularization of libavogadro</h2>

<p>Libavogadro contains a lot of APIs for different purposes and tends to grow. I propose to divide it into several modules (as Qt did when moving to Qt4)</p>

<p>For compatibility with previous versions, monolithic libavogadro library is provided</p>

<p>Generic classes which could be used even by terminal applications to simplify access to OB and make some advanced operations with molecules. <big></big></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Atom
Bond
Cube
Fragment
IDList
Mesh
MeshGenerator
Molecule
MoleculeFile
NeighborList (?)
Primitive
PrimitiveList
Protein (?)
Residue
ZMatrix 
</code></pre>
</div>

<p>&lt;/big&gt;</p>

<p>(partially done - didn’t separate it from Python yet)</p>

<p>Rendering of molecules in external apps (including Avogadro). Static (“core”) engine/tools also go here.</p>

<p>Since it’s intended to be easy-to-use Qt widget, Designer plugin will be desired. <big></big></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Animation
Camera
Color3f
ColorButton (?)
Cylinder_p
GLHit
GLPainter_p
GLWidget
Navigate
Painter
PainterDevice
UndoSequence

Color
Engine
Extension
DockExtension
Tool
ToolGroup
</code></pre>
</div>

<p>&lt;/big&gt;</p>

<p>Also, it’s needed to create class AvogadroWidget which will allow to choose what subclass of RenderWidget is used</p>

<p>Everything Python-related <big></big></p>

<div class="highlighter-rouge"><pre class="highlight"><code>pythonengine
pythonerror
pythonextension_p
pythoninterpreter
pythonscript
pythonthread_p
pythontool_p
</code></pre>
</div>

<p>&lt;/big&gt;</p>

<ul>
  <li><strong>AvogadroPython</strong> should be made a plugin - if AvogadroWidget is compiled with Python support, it must work when AvogadroPython library is missing, and load it if it’s present. It will provide additional flexibility for bundle packages (Windows and Mac - user will be able to choose install it or not), and for traditional unix packages (one component - one package). Also, other scripting languages maybe added as plugins</li>
</ul>

<!-- -->

<ul>
  <li>Add PythonPluginManager, inherited from PluginManager - AvogadroWidget should not be linked with Python or Boost to be lightweight.</li>
</ul>

<p><big></big></p>

<div class="highlighter-rouge"><pre class="highlight"><code>ElementDetail
ElementItem
ElementTranslator
PeriodicTableScene
PeriodicTableView
</code></pre>
</div>

<p>&lt;/big&gt;</p>

<p><big></big></p>

<div class="highlighter-rouge"><pre class="highlight"><code>plotaxis
plotobject
plotpoint
plotwidget
</code></pre>
</div>

<p>&lt;/big&gt;</p>

<ul>
  <li>Also, new module with basis set related files from extensions/ directory could be introduced</li>
</ul>

<p><big></big></p>

<div class="highlighter-rouge"><pre class="highlight"><code>basisset
molpro 
mopacaux
gaussianfchk
</code></pre>
</div>

<p>&lt;/big&gt;</p>

<p>If you think 3 latter modules are too small, they could be merged in one, e.g. AvogadroExtra. However, see my proposition about plotwidget before. Also, there are a lot of types of basis sets. Periodic table could run as standalone application (there’s gelemental though)</p>

<h2 id="source-tree">Source Tree</h2>

<p>Current source tree is very complicated and “overpopulated”. Extensions directory looks like a dump.</p>

<ul>
  <li>Divide libavogadro and avogadro repositories, create a superpackage instead. It isn’t actual now, but if ABI is stable, application and library releases may be done separately, especially bugfix ones. What about Windows and Mac users? They may receive such bugfixes as incremental updates (e.g., download only avogadro.exe through update manager instead of full installation procedure for new release)</li>
</ul>

<!-- -->

<ul>
  <li>Separate sources of modules: AvogadroCore, AvogadroWidget, AvogadroPython</li>
</ul>

<!-- -->

<ul>
  <li>Divide extensions into:
    <ul>
      <li>Main - live in Git of (lib)avogadro (e.g., animationextension,cartesianextension, fileimportextension, networkfetchextension, propextension, selectextension)</li>
      <li>Extras:
        <ul>
          <li>Quantum - input generators, MO surfaces, basis set code</li>
          <li>Crystal - unitcell, supercell (?)</li>
          <li>Spectra</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Of course, everything could be built together as superpackage</p>



    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="//github.com/avogadro/Avogadro.github.io/edit/master/_developer/refactoring_ideas.md">Edit this on GitHub</a>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/AvogadroChem"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/avogadro"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://avogadro.org/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Avogadro Chemistry. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="https://avogadro.org/assets/js/main.min.js"></script>





  

<script type="text/javascript">
    DiscourseEmbed = { discourseUrl: '//discuss.avogadro.cc/',
                       discourseEmbedUrl: 'https://avogadro.org/developer/refactoring_ideas/' };
   (function () {
     var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
     d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
   })();
</script>
<noscript>Please enable JavaScript to view the comments powered by <a href="https://www.discourse.org/">Discourse.</a></noscript>







  </body>
</html>
